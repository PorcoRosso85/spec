# manifest-guard.md

## これは何か
壊すと一発でサービスが落ちる/お金が飛ぶような重要なマニフェスト(例: インフラ定義、課金ルール、権限スコープなど)を安全に変更するためのチェックリスト。

このドキュメントの目的は『うっかり事故』を防ぐこと。
設計の背景は docs/adr/ 側に置く。

## 変更前チェックリスト
1. どのファイルを触るのかを特定したか？
   - 例: infra/production.yaml など。
2. そのファイルはどこで読み込まれているか分かっているか？
   - 本番だけ？開発環境も？課金計算も？
3. 該当の設定キー/フィールドの意味を理解しているか？
   - よく分からない項目は勝手に削除/renameしない。
4. 影響範囲をメモしたか？
   - 課金/請求/セキュリティ/ユーザーデータ消失 などリスク系は特に。
5. ローカル or ステージングで試せるか？
   - 試せるなら必ず試す。

## PRの作り方 (manifest系の変更)
1. 変更はピンポイントに小さく分ける。
   - 関係ないリファクタを同じPRに混ぜない。
2. PRタイトルに "[manifest]" など分かりやすいprefixを付ける。
3. このチェックリストの回答(影響範囲や確認方法)をPR本文に貼る。
4. mainに直接pushしない。必ずPR経由にする。

## マージ後チェック
1. 実際に本番で反映されたか確認する。
2. 監視/ログ/メトリクスに異常がないかを見る。
3. もし何か壊したら、元のcommitにrevertするPRを即座に切る。

## 今後の自動化TODO
- 重要manifestのパスをCIで監視し、変更があるPRには自動で
  "manifest変更チェックリストを書いてください" とコメントさせる。
- 危険なフィールド(例: public=true など)のdiffを強調表示するbotをつくる。

## 関連
- 運用ハンドブック: ./index.md
- シークレット管理: ./secrets.md
- リポジトリ全体の構成: ../structure/index.md
