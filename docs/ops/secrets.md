# secrets.md

## 目的
機密情報(APIキー・署名鍵・DB接続文字列など)の取り扱いルールと手順をまとめる。
漏れると即アウトなものはここを守る。

> このドキュメントは手順書です。なぜこの構成にしたか等の背景は docs/adr/ 側に書きます。

## 保管場所 (どこに置くか)
※ 実際のサービス名/金庫名はTODOを埋めてください。

1. サーバや本番運用で使う値
   - GitHub Actions の repository secrets (TODO: 名前)
   - / インフラ側のシークレットマネージャ (TODO: 例えば AWS SSM Parameter Store 等)
2. ローカル開発用の値
   - .env.local などローカル専用ファイル。
   - これらは git にコミットしない。
3. 共有が必要な平文では見せられない値
   - 1Password の共有ボールト (TODO: vault名) で管理。

## 追加手順 (新しいシークレットを作るとき)
1. ローカルで仮の値を発行する。
2. 名前と用途を決める。
   - 例: PAYMENT_PROVIDER_API_KEY / 決済プロバイダへのAPIキー
3. 本番用の値を発行する。(例: 管理画面でキーを作る)
4. 本番用の値を1Password等の保管場所に保存する。
5. CI/CDや本番実行環境のシークレットストアに登録する。
6. .env.example など公開可能なダミー値サンプルを更新する
   - 新しいキー名だけは載せる
   - 値はダミーにする

## ローテーション手順 (キーを入れ替えたいとき)
1. 新しいキーを発行する。
2. 旧キーを消さずに、新旧どちらでも動く状態にできるか確認する。
3. 新しいキーをストア(1Password / GitHub Secrets等)に登録する。
4. デプロイして新キーで動くことを確認する。
5. 問題なければ旧キーを無効化/削除する。
6. ドキュメント上の記述を最新化する。

## 禁止事項
- シークレットを平文でgitにコミットしない。
- 個人Slack/DMや個人メモにしか残さない。必ずチームで共有できる保管場所に入れる。
- 同じキーを検証環境と本番で再利用する。

## 関連
- 運用ハンドブック: ./index.md
- manifest変更時の安全確認: ./manifest-guard.md
- リポジトリ全体の構成: ../structure/index.md
