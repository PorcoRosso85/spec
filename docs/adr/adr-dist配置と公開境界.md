# ADR: dist配置と公開境界の扱い

## 状態
Accepted / 2025-11-01

## 背景
- このリポジトリには 内部向けの生ドキュメントや実装メモ と 外に出してよい公開物 (pSEO含む) の両方がある。
- いままでは `site/` や `www/` のようなフォルダ名で公開物を置く案があったが:
  - どこから生成されたのかが分かりにくい
  - DDD的な `interfaces/` に置くと I/O境界のコードと完成済み静的サイトが同居して曖昧になる
- 生成はflake+CIで自動化する前提であり 手書きのソースと CIが吐いた最終物を同じ場所に置きたくない。

よって 生成された公開物は dist/ に集約し そこをクロール可の境界として明示する。

## 決定
1. 公開用ビルド成果物は dist/ に置く。dist/ は各ソースディレクトリの直下に置く。
   - docs/dist/
   - specification/dist/
   - 将来的に他ディレクトリでも同じルールで <dir>/dist/ を置いてよい

2. docs/dist/
   - docs/ は内部向けの手順 運用 背景メモなどフルで持つ場所 (生ソース)。
   - そのうち外に出してよい 出したい部分だけを CI で静的に整形したものを docs/dist/ に置く。
   - docs/dist/ は pSEO の露出対象になり得る。

3. specification/dist/
   - specification/ は実装仕様 制約 APIふるまいなどの開発者向けドキュメント (生ソース)。
   - 外部パートナーやユーザに見せたい形に整えた公開版を specification/dist/ に置く。
   - つまり 内部実装の説明のうち対外向けに出してよい面だけがここに入る。

4. dist/ 配下のディレクトリ構造は 元ソースのパス構造をミラーする。
   - 例: docs/foo/bar.md から公開生成したなら docs/dist/foo/bar.html (拡張子はCI側が決める)。
   - これで公開物がどのソース由来かパスだけで逆引きできる。
   - ソースとの対応が不明な単発HTMLファイルを dist/ 直下に直置きするのは禁止。

5. www や site のようなトップ階層は作らない。
   - 公開境界は */dist/ というディレクトリ規約だけで示す。
   - ここに入ったものは外に出す 前提 で統一する。

6. interfaces/ には公開サイト本体を置かない。
   - interfaces/ はDDDのインターフェース層 (I/O境界) として扱う。CLIエントリやAPIエンドポイントが入る場所。
   - CIが叩くビルド用CLI (interfaces/cli/ 想定) はOK。
   - ただし ユーザやクローラに見せる最終的な静的ページ本体は docs/dist/ や specification/dist/ 側に置く。

7. architecture/ のような新しいトップディレクトリは今は増やさない。
   - 将来的にアーキ図 Mermaid→SVG 等を公開したい場合は 元ソースをどこかに置き 生成SVGを対応する dist/ 側に吐く。
   - いまはまだ公式ディレクトリとして固定しない。

8. PDF化は現時点ではやらない。
   - HTMLやMarkdown等のテキスト中心でまず回す。
   - PDF生成パイプは将来タスク扱いでCIからは外す。

## なぜこの決定か
- 公開境界を dist/ に統一することで これは外に出してよいか をディレクトリ名だけで判別できる。
- docs/ や specification/ の生ソースは内部向けのまま自由に書ける。トーン調整や秘匿項目の削除は dist 側で完了させる。
- interfaces/ に公開サイトを混ぜないので DDDの層の意味が濁らない。
- 生成物と元ソースの対応がパスで追えるので 運用とレビューがしやすい。

## 影響
- ツリー上は少なくともこうなる想定:
  - docs/                # 内部ドキュメントの正
    - dist/              # 公開用に整えた成果物 (pSEO対象)
  - specification/       # 実装仕様と振る舞いの正
    - dist/              # 外部公開用に整えた仕様説明
  - interfaces/cli/      # CIやflakeから dist/ を再生成するCLIエントリ

- デプロイ CDN 検索エンジンへの公開は基本 */dist/ を対象にすれば良い。

## オープン課題
- CIでどのflakeターゲットを実行して dist/ を更新するか。
- pSEO向けのメタ情報 (title description schema.org など) を dist 側にどこまで埋めるか。
- ライセンスやシークレットを含ませないフィルタをどこで強制するか。

## まとめ
- 公開用アウトプットは */dist/ に固定する。
- dist/ の中はソース側パスをミラーする。
- interfaces/ はI O境界やCLIに専念させ 公開静的ページ本体は dist/ に置く。
- www や site は使わない。
- PDFと architecture/ は後でやる。
